<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DataHarmonizer</title>
    <link rel="stylesheet" href="./main.css">
  </head>
  <body>
    <div class="w-100 h-100 position-fixed fixed-top" id="loading-screen">
      <div class="d-flex h-100 align-items-center justify-content-center">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">Please wait...</span>
        </div>
      </div>
    </div>
    <!-- flex grid -->
    <div class="container-fluid">
      <!-- buttons above Handsontable grid -->
      <div class="row mt-3" id="header-row">
        <div class="col">

          <div class="btn-group" role="group">

            <div class="btn-group" id="file-dropdown-btn-group" role="group">
              <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">File</button>
              <div class="dropdown-menu">
                <span class="dropdown-item" data-toggle="modal" data-target="#select-template-modal">Change Template</span>
                <span class="dropdown-item" id="new-dropdown-item">New</span>
                <label for="open-file-input" class="dropdown-item mb-0" id="open-dropdown-item">Open</label>
                <input type="file" accept=".xlsx,.xls,.tsv,.csv" class="form-control-file" id="open-file-input">
                <span class="dropdown-item" data-toggle="modal" id="save-as-dropdown-item">Save As...</span>
                <span class="dropdown-item" data-toggle="modal" id="export-to-dropdown-item">Export To...</span>
                <!-- span class="dropdown-item" data-toggle="modal" id="export-to-dropdown-item" data-target="#export-to-modal">Export To...</span -->
              </div>
            </div>
            <div class="btn-group" id="settings-dropdown-btn-group" role="group">
              <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Settings</button>
              <div class="dropdown-menu">

                <span class="dropdown-item disabled" id="show-all-cols-dropdown-item">Show all columns</span>
                <span class="dropdown-item" id="show-required-cols-dropdown-item">Show required columns</span>
                <span class="dropdown-item" id="show-recommended-cols-dropdown-item">Show required + recommended columns</span>
                <div style="padding: 0.25rem 1.5rem">Show section: 
                  <div id="section-menu"></div>
                </div>

                <span class="dropdown-item hidden-dropdown-item" id="show-all-rows-dropdown-item">Show all rows</span>
                <span class="dropdown-item hidden-dropdown-item" id="show-valid-rows-dropdown-item">Show valid rows</span>
                <span class="dropdown-item hidden-dropdown-item" id="show-invalid-rows-dropdown-item">Show invalid rows</span>

                <span class="dropdown-item" id="jump-to-dropdown-item" data-toggle="modal" data-target="#jump-to-modal">Jump to...</span>
                <span class="dropdown-item" id="fill-dropdown-item" data-toggle="modal" data-target="#fill-modal">Fill column...</span>

                <span class="dropdown-item disabled" id="version-dropdown-item"></span>
              </div>
            </div>
            <button type="button" class="btn btn-primary" id="validate-btn">Validate</button>
          </div>

          <div class="btn-group d-none d-sm-inline" role="group">
            <button class="btn btn-info dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Help</button>
            <div class="dropdown-menu">
              <span class="dropdown-item" data-toggle="modal" data-target="#getting-started-modal">Getting Started</span>
              <a class="dropdown-item" target="_blank" id="help_reference" href="">Reference Guide</a>
              <a class="dropdown-item" target="_blank" id="help_sop" href="">SOP</a>
              <a class="dropdown-item" target="_blank" id="help_release" href="https://github.com/Public-Health-Bioinformatics/DataHarmonizer/releases">Get Latest Release</a>
              <span class="dropdown-item" data-toggle="modal" data-target="#contact-us-modal">Contact Us</span>
            </div>
          </div>

          <div class="btn-group" role="group" style="margin-right:40px">
              <div class="input-group-prepend">
                <div class="btn">Template</div>
              </div>
              <div class="input-group-append">
                <div class="input-group-text" id="template_name_display" style="background-color:transparent;cursor:pointer"  data-toggle="modal" data-target="#select-template-modal"></div>
              </div>
          </div>

          <div class="btn-group" role="group" style="margin-right:40px">
              <div class="input-group-prepend">
                <div class="btn">Loaded file</div>
              </div>
              <div class="input-group-append">
                <div class="input-group-text" id="file_name_display" style="background-color:transparent"></div>
              </div>
          </div>

          <div class="btn-group" role="group" >
              <div class="input-group-append">
                <button class="btn btn-primary" id="next-error-button" type="submit">Next Error</button>
                <div class="btn btn-primary" id="no-error-button" type="submit">No Errors</div>
              </div>
          </div>


        </div>

      </div>
      <!-- Handsontable grid -->
      <div class="row mt-3">
        <div class="col">
          <div id="grid"></div>
        </div>
      </div>
      <!-- Buttons below Handsontable grid -->
      <div class="row mt-3" id="footer-row">
        <div class="col col-md-6">
          <div class="input-group">
            <div class="input-group-prepend">
              <button class="btn btn-primary" id="add-rows-button" type="submit">Add</button>
            </div>
            <input type="text" class="form-control" id="add-rows-input" value="100">
            <div class="input-group-append">
              <span class="input-group-text">more rows at the bottom.</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Modals -->
    <div class="modal" id="select-template-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text">Change Template </span>
                    </div>
                    <select class="form-control" id="select-template"></select>
                    <div class="input-group-append">
                      <button type="button" class="btn btn-primary" data-dismiss="modal" id="select-template-load">Open</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col d-flex d-flex">
                  <input type="checkbox" id="view-template-drafts" style="margin:6px">
                  <label for="#view-template-drafts">View draft templates</label>
                </div>
                <div class="col d-flex d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="clear-data-warning-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col">
                  <span class="text-danger">Clear existing data?</span>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-2 col-sm-6"></div>
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-danger" id="clear-data-confirm-btn" data-dismiss="modal">Clear</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal" id="save-as-invalid-warning-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col text-danger">You have invalid cells. Continue saving?</div>
              </div>
              <div class="row mt-3">
                <div class="col-2 col-sm-6"></div>
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-danger" data-dismiss="modal" data-toggle="modal" data-target="#save-as-modal">Continue</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="save-as-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col text-danger" id="save-as-err-msg"></div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="input-group">
                    <input type="text" class="form-control" id="base-name-save-as-input" placeholder="file name">
                    <div class="input-group-append">
                      <select class="form-control" id="file-ext-save-as-select">
                        <option value="xlsx" selected>.xlsx</option>
                        <option value="xls">.xls</option>
                        <option value="tsv">.tsv</option>
                        <option value="csv">.csv</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-2 col-sm-6"></div>
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-primary" id="save-as-confirm-btn">Save</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="export-to-invalid-warning-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col text-danger">You have invalid cells. Continue exporting?</div>
              </div>
              <div class="row mt-3">
                <div class="col-2 col-sm-6"></div>
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-danger" data-dismiss="modal" data-toggle="modal" data-target="#export-to-modal">Continue</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="export-to-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col text-danger" id="export-to-err-msg"></div>
              </div>
              <div class="row">
                <div class="col-12 col-sm-8">
                  <div class="input-group">
                    <input type="text" class="form-control" id="base-name-export-to-input" placeholder="file name">
                    <div class="input-group-append">
                      <div class="input-group-text" id="export_file_suffix">.xls</div>
                    </div>
                  </div>
                </div>
                <div class="col mt-2 mt-sm-0">
                  <select class="form-control" id="export-to-format-select">
                    <option value="" disabled selected>Format</option>
                  </select>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-2 col-sm-6"></div>
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-primary" id="export-to-confirm-btn">Export</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="specify-headers-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col">The second row in your imported file does not match the template column specification. Mismatched column(s) are shown in orange.</div>
              </div>
              <div class="row my-3 border" id="specify-headers-comparison-row">
                <div class="col">
                  <div class="row" id="field-mapping-container">
                    <table id="field-mapping">
                      <tr id="expected-headers-tr"></tr>
                      <tr id="actual-headers-tr"></tr>
                    </table>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <p>We will try to map your headers.<br/>
                  <b>Which row in your file has the column headers?</b></p>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <input class="form-control" id="specify-headers-input" value="2">
                </div>
              </div>
              <div class="row">
                <div class="col"><i>First row = 1, Second row = 2, etc.</i></div>
              </div>
              <div class="row">
                <div class="col text-danger" id="specify-headers-err-msg">Invalid row</div>
              </div>
              <div class="row mt-3">
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-primary" id="specify-headers-confirm-btn">Ok</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="unmapped-headers-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col text-danger">Failed to map:</div>
              </div>
              <div class="row">
                <div class="col">
                  <ul class="list-unstyled" id="unmapped-headers-list"></ul>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="open-error-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col text-danger" id="open-err-msg"></div>
              </div>
              <div class="row mt-3">
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="jump-to-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col">
                  <div>
                    <label for="jump-to-input">Jump to...</label>
                    <input id="jump-to-input" class="form-control">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="fill-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">

              <div class="row">
                <div class="col-sm-6">
                  <div>
                    <label for="fill-column-input">Fill cells in column ...</label>
                    <input id="fill-column-input" class="form-control">
                  </div>
                </div>
                <div class="col-sm-4">
                  <div>
                    <label for="fill-value-input">with value:</label>
                    <input id="fill-value-input" class="form-control">
                  </div>
                </div>
                <div class="col-sm-1">
                   <div>
                    <label>&nbsp;</label>
                    <button type="button" id="fill-button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
                  </div>
                </div>

              </div>
              <div class="row">
                <div>
                  <br clear="both">
                  <p> Use this feature to populate all the cells of a column with given value.  This won't populate empty rows of the spreadsheet (as occurs when pasting a value to a column's header cell).</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="field-description-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col" id="field-description-text"></div>
              </div>
              <div class="row mt-3">
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="getting-started-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <div class="container-fluid">
              <div class="row">
                <div class="col">
                  <h5>Are you ready to harmonize your contextual data?</h5>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col">
                  <div class="carousel slide" id="getting-started-carousel" data-interval="false">
                    <ol class="carousel-indicators">
                      <li data-target="#getting-started-carousel" data-slide-to="0" class="active"></li>
                      <li data-target="#getting-started-carousel" data-slide-to="1"></li>
                      <li data-target="#getting-started-carousel" data-slide-to="2"></li>
                      <li data-target="#getting-started-carousel" data-slide-to="3"></li>
                      <li data-target="#getting-started-carousel" data-slide-to="4"></li>
                      <li data-target="#getting-started-carousel" data-slide-to="5"></li>
                    </ol>
                    <div class="carousel-inner">
                      <div class="carousel-item active">
                        <img class="d-block w-100" src="images/editCopyPasteDelete.gif">
                        <div class="carousel-caption">
                          <p>The contextual data collection template and validator application enables users to enter data as in an excel spreadsheet - type and pick values from dropdowns, copy/paste, add rows, etc.</p>
                        </div>
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="images/toggleRequiredCols.gif">
                        <div class="carousel-caption">
                          <p>Fields are colour-coded; required fields (minimal metadata) are yellow, strongly recommended fields are purple, optional fields are white.</p>
                          <p>You can toggle between all, and the required fields, by going to “Settings” and selecting “Show Required Columns”.</p>
                        </div>
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="images/doubleClickHeaders.gif">
                        <div class="carousel-caption">
                          <p>Double click on field headers to see the definition of the field, guidance on filling in the field, and examples of how data might look structured according to the constraints of the validator.</p>
                        </div>
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="images/selectingVals.gif">
                        <div class="carousel-caption">
                          <p>Picklists of controlled vocabulary are available for many fields. There are dropdown menus for some, and multi-select options for others (e.g. Signs and Symptoms). You can also see the list of terms in multi-select columns by clicking once in the multi-select box.</p>
                        </div>
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="images/validatingCells.gif">
                        <div class="carousel-caption">
                          <p>When you’re done entering your data, you can validate values by clicking on “Validate”. Errors and missing information in required fields will be coloured red.</p>
                        </div>
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="images/exportingFiles.gif">
                        <div class="carousel-caption">
                          <p>When you’ve entered and validated your data, you can save it as a .xlsx, .xls, .tsv or csv format file, by clicking on “File” followed by “Save as”. You can also format your data for IRIDA upload (you will need to perform the upload yourself), or use your entered data to create a GISAID submission form (you will need to add additional information, and perform the upload yourself), by clicking on "File" followed by "Export to".</p>
                          <p><i>If you have questions, or require assistance, contact emma.griffiths@bccdc.ca.</i></p>
                        </div>
                      </div>
                    </div>
                    <a class="carousel-control-prev" href="#getting-started-carousel" role="button" data-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                       <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#getting-started-carousel" role="button" data-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="sr-only">Next</span>
                    </a>
                  </div>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-primary" data-dismiss="modal">Ok</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="contact-us-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col">
                  <p>If you have questions, or want to notify us of bugs or potential improvements, contact us by either posting an issue at:</p>
                  <p>https://github.com/Public-Health-Bioinformatics/DataHarmonizer/issues</p>
                  <p>Or emailing us at:</p>
                  <p>emma_griffiths@sfu.ca</p>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="missing-template-modal" role="dialog" style="display:none">
      <div class="modal-dialog" role="document">
        <div class="modal-content" style="z-index:2000">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row">
                <div class="col text-danger" id="missing-template-msg"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- External libraries -->
    <script src="libraries/jquery-3.5.1.min.js"></script>
    <script src="libraries/popper.min.js"></script>
    <script src="libraries/bootstrap.min.js"></script>
    <script src="libraries/handsontable.full.min.js"></script>
    <script type="text/javascript" src="libraries/shim.min.js"></script>
    <script type="text/javascript" src="libraries/xlsx.full.min.js"></script>
    <script type="text/javascript" src="libraries/chosen.jquery.min.js"></script>
    <script type="text/javascript" src="libraries/moment.min.js"></script>
    <script type="text/javascript" src="libraries/jquery-ui.min.js"></script>
    <script type="text/javascript" src="libraries/FileSaver.min.js"></script>
    <script src="script/export_utils.js"></script>
    <script src="script/main.js"></script>
  </body>
</html>
